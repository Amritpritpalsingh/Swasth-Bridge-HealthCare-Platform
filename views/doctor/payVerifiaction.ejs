<%- layout("layouts/mainDoc.ejs") %>

<h3 class="mb-4 mt-4 text-light">ðŸ§¾ Payment Verification</h3>

<!-- Table: visible on sm+ -->
<div id="paymentsTableWrapper" class="d-none d-sm-block">
  <table id="paymentsTable" class="table table-bordered table-hover align-middle text-light">
    <thead>
      <tr>
        <th>Patient</th>
        <th>Amount</th>
        <th>Transaction ID</th>
        <th>Screenshot</th>
        <th>Paid At</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="paymentsTableBody">
      <% payments.forEach(p => { %>
        <tr>
          <td><%= p.patient?.name || "Unknown" %></td>
          <td>â‚¹<%= p.payment.amount || 0 %></td>
          <td><%= p.payment.transactionId || "N/A" %></td>
          <td>
            <% if (p.payment.screenshot) { %>
              <a href="<%= p.payment.screenshot %>" target="_blank" class="text-info">View</a>
            <% } else { %>
              <span class="text-muted">No screenshot</span>
            <% } %>
          </td>
          <td><%= new Date(p.payment.paidAt).toLocaleString() %></td>
          <td>
            <span class="badge <%= p.payment.verified ? 'bg-success' : 'bg-warning text-dark' %>">
              <%= p.payment.verified ? 'Verified' : 'Pending' %>
            </span>
          </td>
          <td>
            <% if (!p.payment.verified) { %>
              <button class="btn btn-sm btn-success verify-btn mb-1" data-id="<%= p._id %>">Verify</button>
              <button class="btn btn-sm btn-danger reject-btn mb-1" data-id="<%= p._id %>">Reject</button>
            <% } else { %>
              <span class="text-muted">Done</span>
            <% } %>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</div>

<!-- Cards: visible only on mobile -->
<div id="paymentsCardList" class="d-sm-none">
  <div class="row g-3" id="paymentsCardListBody">
    <% payments.forEach((p) => { %>
      <div class="col-12">
        <div class="card p-3 shadow-sm rounded-3 dark-mode-card">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <h6 class="mb-0"><%= p.patient?.name || "Unknown" %></h6>
            <span class="badge <%= p.payment.verified ? 'bg-success' : 'bg-warning text-dark' %>">
              <%= p.payment.verified ? 'Verified' : 'Pending' %>
            </span>
          </div>
          <p class="mb-1"><strong>Amount:</strong> â‚¹<%= p.payment.amount || 0 %></p>
          <p class="mb-1"><strong>Transaction ID:</strong> <%= p.payment.transactionId || "N/A" %></p>
          <p class="mb-1">
            <strong>Screenshot:</strong>
            <% if (p.payment.screenshot) { %>
              <a href="<%= p.payment.screenshot %>" target="_blank" class="text-info">View</a>
            <% } else { %>
              <span class="text-muted">No screenshot</span>
            <% } %>
          </p>
          <p class="mb-1"><strong>Paid At:</strong> <%= new Date(p.payment.paidAt).toLocaleString() %></p>
          <div class="d-flex gap-2 mt-2">
            <% if (!p.payment.verified) { %>
              <button class="btn btn-sm btn-success verify-btn" data-id="<%= p._id %>">Verify</button>
              <button class="btn btn-sm btn-danger reject-btn" data-id="<%= p._id %>">Reject</button>
            <% } else { %>
              <span class="text-muted">Done</span>
            <% } %>
          </div>
        </div>
      </div>
    <% }) %>
  </div>
</div>
